<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>添加菜单</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <!-- 引入 dtree 相关资源 -->
    <link rel="stylesheet" href="/js/lay-module/dtree/dtree.css">
    <link rel="stylesheet" href="/js/lay-module/dtree/font/dtreefont.css">
    <!-- 引入 font-aswsome 相关资源 -->
    <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" href="/lib/highlight/highlight.min.css">

</head>
<body>

<div class="layuimini-container">
    <div class="layuimini-main">
        <div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>请求用户：</b></label>
                <div class="layui-input-block">
                    <div class="layui-form-mid" th:text="${logRequest.userId}"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>请求IP：</b></label>
                <div class="layui-input-block">
                    <div class="layui-form-mid " th:text="${logRequest.ip}"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>用户UA：</b></label>
                <div class="layui-input-block">
                    <div class="layui-form-mid " th:text="${logRequest.userAgent}"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>请求URI：</b></label>
                <div class="layui-input-block">
                    <div class="layui-form-mid " th:text="${logRequest.reqUri}"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>请求函数：</b></label>
                <div class="layui-input-block">
                    <div class="layui-form-mid " th:text="${logRequest.reqFunction}"></div>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>请求数据：</b></label>
                <div class="layui-input-block">
                    <pre><code class="language-json" id="logReqData" th:text="${logRequest.reqData}"></code></pre>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label"><b>响应数据：</b></label>
                <div class="layui-input-block">
                    <pre><code class="language-json" id="logResData" th:text="${logRequest.resData}"></code></pre>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script src="/lib/highlight/highlight.min.js"></script>
<script>
    layui.use(['form'], function () {
        let $ = layui.jquery;
        let form = layui.form;

        $("#logReqData").html(format($("#logReqData").html(), false))
        $("#logResData").html(format($("#logResData").html(), false))

        hljs.configure({
            tabReplace: '    ', // 4 spaces
        });
        hljs.highlightAll()
    });

    // JSON字符串格式化工具
    function format(txt, compress/*是否为压缩模式*/) {
        // 缩进字符
        let indentChar = '   ';
        if (/^\s*$/.test(txt)) {
            console.log('数据为空,无法格式化! ');
            return txt;
        }
        let data = "";
        try {
            data = eval('(' + txt + ')');
        } catch (e) {
            console.log('数据源语法错误,格式化失败! 错误信息: ' + e.description);
            return txt;
        }
        var draw = [], last = false, This = this, line = compress ? '' : '\n', nodeCount = 0, maxDepth = 0;

        var notify = function (name, value, isLast, indent/*缩进*/, formObj) {
            nodeCount++;/*节点计数*/
            for (var i = 0, tab = ''; i < indent; i++) tab += indentChar;/* 缩进HTML */
            tab = compress ? '' : tab;/*压缩模式忽略缩进*/
            maxDepth = ++indent;/*缩进递增并记录*/
            if (value && value.constructor == Array) {/*处理数组*/
                draw.push(tab + (formObj ? ('"' + name + '":') : '') + '[' + line);/*缩进'[' 然后换行*/
                for (var i = 0; i < value.length; i++)
                    notify(i, value[i], i == value.length - 1, indent, false);
                draw.push(tab + ']' + (isLast ? line : (',' + line)));/*缩进']'换行,若非尾元素则添加逗号*/
            } else if (value && typeof value == 'object') {/*处理对象*/
                draw.push(tab + (formObj ? ('"' + name + '":') : '') + '{' + line);/*缩进'{' 然后换行*/
                var len = 0, i = 0;
                for (var key in value) len++;
                for (var key in value) notify(key, value[key], ++i == len, indent, true);
                draw.push(tab + '}' + (isLast ? line : (',' + line)));/*缩进'}'换行,若非尾元素则添加逗号*/
            } else {
                if (typeof value == 'string') value = '"' + value + '"';
                draw.push(tab + (formObj ? ('"' + name + '":') : '') + value + (isLast ? '' : ',') + line);
            }
            ;
        };
        var isLast = true, indent = 0;
        notify('', data, isLast, indent, false);
        return draw.join('');
    }
</script>
</body>
</html>