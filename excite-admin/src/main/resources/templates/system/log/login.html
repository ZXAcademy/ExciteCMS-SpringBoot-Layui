<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>登录日志</title>
    <link rel="stylesheet" href="/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/public.css" media="all">
    <link rel="stylesheet" href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <!-- 上方搜索栏 -->
        <fieldset class="table-search-fieldset">
            <legend>搜索</legend>
            <div class="layui-form layui-form-pane">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <!-- 用户ID-->
                        <label class="layui-form-label" style="width: 100px">用户ID</label>
                        <div class="layui-input-inline" style="width: 150px">
                            <input type="text" id="inputUserId" autocomplete="off" class="layui-input" placeholder="输入ID"/>
                        </div>
                        <!-- 时间范围选择 -->
                        <label class="layui-form-label" style="width: 100px">日期范围</label>
                        <div class="layui-input-inline" style="width: 150px">
                            <input type="text" id="inputDateStart" autocomplete="off" class="layui-input" placeholder="选择开始时间" readonly>
                        </div>
                        <div class="layui-form-mid">-</div>
                        <div class="layui-input-inline" style="width: 150px">
                            <input type="text" id="inputDateEnd" autocomplete="off" class="layui-input" placeholder="选择结束时间" readonly>
                        </div>
                    </div>
                    <!-- 搜索按钮 -->
                    <div class="layui-inline">
                        <button type="button" class="layui-btn layui-btn-primary layui-border-green" id="btn-user-search" data-type="reload"><i class="layui-icon"></i> 搜 索
                        </button>
                    </div>
                </div>
            </div>
        </fieldset>

        <!-- 表格 -->
        <table class="layui-hide" id="table-system-requestLog" lay-filter="table-system-requestLog"></table>

    </div>
</div>
<!--表格头部工具类（左上）-->
<script type="text/html" id="toolbar-table-requestLog">
    <div class="layui-btn-container">
        <!-- 【刷新】-->
        <button class="layui-btn layui-btn-sm layuimini-btn-primary" lay-event="btn-requestLog-refresh"><i class="fa fa-refresh"></i></button>
    </div>

</script>
<!--表格每行末尾的操作按钮-->
<script type="text/html" id="tool-table-requestLog">
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="requestLog-details">详情</a>
    <!--    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="requestLog-delete">删除</a>-->
</script>
<!--引入JS文件-->
<script src="/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="/js/lay-config.js?v=1.0.4" charset="utf-8"></script>
<script>
    layui.use(['table'], function () {
        let $ = layui.jquery,
            form = layui.form,
            laydate = layui.laydate,
            table = layui.table;

        // 表格
        let table_requestLog = table.render({
            elem: '#table-system-requestLog',
            url: '/system/log/loginList',
            response: {
                statusCode: 200
            },
            height: 'full-158', //高度最大化减去差值
            toolbar: '#toolbar-table-requestLog', //开启头部工具栏，并为其绑定左侧模板
            defaultToolbar: ['filter', 'exports'],
            title: '用户登录日志表',
            cols: [
                [
                    {type: "checkbox", width: 50},
                    {field: 'id', title: '编号', width: 100, align: 'center', sort: true},
                    {field: 'userId', title: '用户ID', width: 100, align: 'center'},
                    {field: 'userAccount', title: '登录账号', width: 200, align: 'center'},
                    {field: 'ip', title: '登录IP', width: 100, align: 'center'},
                    {field: 'userAgent', title: '系统与浏览器', align: 'center'},
                    {field: 'timeCost', title: '用时(ms)', align: 'center', width: 100},
                    {
                        field: 'status', title: '请求结果', align: 'center', width: 100, templet: function (d) {
                            if (d.status === 1) {
                                return '<span class="layui-badge layui-bg-green">登录成功</span>'
                            } else {
                                return '<span class="layui-badge">登录失败</span>'
                            }
                        }
                    },
                    {field: 'createTime', title: '操作时间', align: 'center', width: 200},
                    {fixed: 'right', title: '操作', align: 'center', toolbar: '#tool-table-requestLog', width: 95}
                ]
            ],
            page: true
        });

        // 表格重载
        let active = {
            reload: function () {
                // 几个搜索框
                let roleName = $('#inputRoleName');
                let rolePermission = $('#inputRolePermission');
                //执行重载
                table.reload('table-system-requestLog', {
                    page: {
                        curr: 1         //重新从第 1 页开始
                    }, where: {
                        name: roleName.val(),
                        permission: rolePermission.val()
                    }
                });
            },
            refresh: function () {
                //执行重载
                table.reload('table-system-requestLog', {
                    page: {
                        curr: 1         //重新从第 1 页开始
                    }, where: {
                        name: "",
                        permission: ""
                    }
                });
            }
        };
        $('#btn-requestLog-search').on('click', function () {
            let type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

//日期范围
        let dateStart = laydate.render({
            elem: '#inputDateStart',
            max: 1, // 最大时间为下一天的0点
            type: 'datetime',
            trigger: 'click', //采用click弹出
            done: function (value, dates) {
                dateEnd.config.min = {
                    year: dates.year,
                    month: dates.month - 1, //关键
                    date: dates.date,
                    hours: dates.hours,
                    minutes: dates.minutes,
                    seconds: dates.seconds + 1
                };
            }
        });
        let dateEnd = laydate.render({
            elem: '#inputDateEnd',
            max: 1,
            type: 'datetime',
            trigger: 'click',
            done: function (value, dates) {
                dateStart.config.max = {
                    year: dates.year,
                    month: dates.month - 1, //关键
                    date: dates.date,
                    hours: dates.hours,
                    minutes: dates.minutes,
                    seconds: dates.seconds - 1
                };
            }
        });

        // 【头部按钮】监听头部按钮
        table.on('toolbar(table-system-requestLog)', function (obj) {
            console.log(obj.event)
            switch (obj.event) {
                // 【刷新】按钮
                case "btn-requestLog-refresh":
                    //执行重载
                    table.reload('table-system-requestLog', {
                        page: {
                            curr: 1
                        }, where: {
                            name: "",
                            permission: ""
                        }
                    });
                    break;
            }
        });


        // 【行末操作】监听表格行末按钮
        table.on('tool(table-system-requestLog)', function (obj) {
            let data = obj.data;
            let layEvent = obj.event;
            switch (layEvent) {
                // 【编辑】按钮
                case "requestLog-details":
                    let reqLog_details_index = layer.open({
                        title: '编辑角色',
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['600px', '500px'],
                        content: '/system/log/login/detail/' + data.id,
                        end: function () {

                        }
                    });
                    parent.layer.iframeAuto(reqLog_details_index);
                    break;
                // 【删除】按钮
                case "role-delete":
                    // TODO 执行删除的POST操作
                    layer.msg('删除接口未对接...删除角色：' + data.name)
                    break;
            }
        });
    });
</script>
</body>
</html>